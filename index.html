<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Museum Height</title>
    <meta name="description" content="Hang art in your home at a museum height of 57 inches (144cm) without doing math">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />


    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.museumheight.com/">
    <meta property="og:title" content="Museum Height">
    <meta property="og:description" content="Hang art in your home at a museum height of 57 inches (144cm) without doing math">
    <meta property="og:image" content="https://www.museumheight.com/opengraph.png">

    <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://www.museumheight.com/">
    <meta property="twitter:title" content="Museum Height">
    <meta property="twitter:description" content="Hang art in your home at a museum height of 57 inches (144cm) without doing math">
    <meta property="twitter:image" content="https://www.museumheight.com/opengraph.png">

    <!-- TailwindCSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- jQuery CDN -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;500;700;900&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Montserrat', sans-serif; } 

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .fade-in {
            animation: fadeIn ease-in 1;
            animation-fill-mode: forwards;
            animation-duration: .5s;
            opacity: 0;
        }
    </style>
</head>

<body class="h-dvh">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 h-full">
        <!-- Input Form Column -->
        <div class="mx-auto w-full bg-slate-950 md:h-screen flex flex-col justify-center items-center">
            <div class="md:w-8/12 ">
                <div class="w-full py-3 md:py-0 grid grid-cols-6 gap-4 md:grid-cols-1 justify-center items-center">
                    <div class="w-10"></div>
                    <div class="col-span-4">
                        <h1 class="text-center md:text-left text-xl md:text-6xl font-bold text-slate-300 tracking-wide md:mb-6 md:w-5/12">Museum Height</h1>
                        <h2 class="hidden md:block text-center md:text-left text-md md:text-2xl text-slate-400">Hang your art like the pros</h2>
                    </div>
                    <div class="w-10 md:hidden flex justify-center items-center text-slate-400 js-settings-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z" />
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                        </svg>
                    </div>
                </div>
                <p class="hidden md:block text-slate-500 mt-4">
                    Museum Height is the practice of hanging art on your wall so that its center line is at eye level or 57 inches (144cm). This makes it so when your eyes scan the room, every piece of art looks in harmony, similar to a museum. 
                    <a class="hover:underline text-orange-400" href="https://www.apartmenttherapy.com/how-to-hang-artwork-properly-57-inches-from-the-floor-6174">Learn More</a>.
                </p>
                <p class="hidden md:block text-slate-500 mt-4">
                    Please enjoy the app, and let me know how much you like it at <a class="hover:underline text-orange-400" href="https://twitter.com/hisnameisjimmy">@hisnameisjimmy</a>. I desperately need validation.
                </p>
            </div>
        </div>

        <!-- Picture Display Column -->
        <div class="relative flex flex-col justify-center items-center" id="pictureColumn">
            <div id="pictureDisplay" class="relative flex flex-col w-full justify-center items-center border-b border-slate-300"></div>
            <div class="w-full drop-shadow-lg h-[1px] bg-white"></div>

            <div id="inputForm" class="hidden opacity-0 scale-95 translate-y-1 absolute transition ease-in-out duration-300 w-full md:w-auto z-10 bg-white p-4 flex flex-col border border-neutral-200/70 p-4 shadow-xl">
                <label class="text-sm font-semibold text-slate-600" for="pictureWidth">Width</label>
                <input type="number" id="pictureWidth" class="my-2 px-3 py-1 text-sm bg-transparent border border-input ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-orange-200 focus-visible:ring-offset-2">
                <label class="text-sm font-semibold text-slate-600" for="pictureHeight">Height</label>
                <input type="number" id="pictureHeight" class="my-2 px-3 py-1 text-sm bg-transparent border border-input ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-orange-200 focus-visible:ring-offset-2">
                <label class="text-sm font-semibold text-slate-600 flex justify-items-start items-center" for="hangingNailHeight">Hang Point 
                    <span id="hangPoint" class="group relative ml-2">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 inline text-slate-400">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 1 1-16 0 8 8 0 0 1 16 0ZM8.94 6.94a.75.75 0 1 1-1.061-1.061 3 3 0 1 1 2.871 5.026v.345a.75.75 0 0 1-1.5 0v-.5c0-.72.57-1.172 1.081-1.287A1.5 1.5 0 1 0 8.94 6.94ZM10 15a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z" clip-rule="evenodd" />
                        </svg>
                        <span class="hidden group-hover:block w-[120px] -left-[45px] top-[25px] absolute bg-slate-900 text-xs text-slate-100 rounded-md font-normal p-2">Distance from the top of the art to the stretched wire</span>
                    </span>
                </label>
                <input type="number" id="hangingNailHeight" class="my-2 px-3 py-1 text-sm bg-transparent border border-input ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-orange-200 focus-visible:ring-offset-2">
                <div class="flex space-x-2 justify-end">
                    <button id="cancelFormBtn" class="bg-slate-100 text-slate-800 border border-neutral-200 hover:bg-slate-300 hover:border-slate-400 font-normal text-sm py-3 md:py-2 px-5 md:px-4">Cancel</button>
                    <button id="addPictureBtn" class="bg-slate-900 text-slate-100 border border-slate-950 hover:bg-orange-500 hover:border-orange-500 hover:text-white font-normal text-sm py-3 md:py-2 px-5 md:px-4">Add</button>
                </div>
            </div>

            <div id="errorMessage" class="text-red-500 text-center font-bold mt-4"></div>
            <div id="globalSettings" class="absolute border border-neutral-200 md:border-none px-3 py-4 md:relative shadow-lg md:shadow-none bg-white w-full bottom-0 flex md:!flex flex-col space-y-6 md:flex-row md:justify-center md:mx-auto md:items-end space-y-2 md:space-x-4 hidden">
                <div class="flex flex-col w-full md:w-[160px] h-[54px]">
                    <label class="text-sm font-bold text-slate-600 flex justify-items-start items-center" for="distanceBetween">Space Between 
                        <span id="hangPoint" class="group relative ml-2">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 inline text-slate-400">
                                <path fill-rule="evenodd" d="M18 10a8 8 0 1 1-16 0 8 8 0 0 1 16 0ZM8.94 6.94a.75.75 0 1 1-1.061-1.061 3 3 0 1 1 2.871 5.026v.345a.75.75 0 0 1-1.5 0v-.5c0-.72.57-1.172 1.081-1.287A1.5 1.5 0 1 0 8.94 6.94ZM10 15a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z" clip-rule="evenodd" />
                            </svg>
                            <span class="hidden w-[120px] -left-[45px] top-[25px] group-hover:block absolute bg-slate-900 text-xs text-slate-100 rounded-md font-normal p-2">Vertical Space Between Art</span>
                        </span>
                    </label>
                    <input type="number" id="distanceBetween" class="my-2 px-3 py-1 border border-input ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-orange-200 focus-visible:ring-offset-2">
                </div>
                <div class="flex flex-col w-full md:w-[142px] h-[54px]">
                    <label class="text-sm font-bold text-slate-600 mb-[1px]" for="unit">Unit</label>
                    <select class="my-2 px-3 py-1 border border-input ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-orange-200 focus-visible:ring-offset-2 text-sm border border-slate-200 h-[34px] px-4 pb-2 pt-2 text-slate-600" name="unit" id="unit">
                        <option selected value="inches">Inches</option>
                        <option value="centimeters">Centimeters</option>
                    </select>
                </div>
                <button id="updateGlobalSettingsBtn" class="bg-slate-950 text-slate-200 mb-10 md:!mb-[-9px] border border-slate-950 hover:bg-orange-500 hover:border-orange-600 hover:text-white font-normal text-sm py-3 md:py-2 px-5 md:px-4 md:h-[34px] leading-none">Update</button>
            </div>
        </div>
    </div>

    <!-- JavaScript Logic -->
    <script>
        let pictures = [];
        let unit = "inches";
        let editingIndex = null;
        let multiplier, museumHeight, unitAbbreviated;
        let mouseDownInsidePopover = false;

        $(document).ready(function () {
            initializePage();
            setupEventListeners();
        });

        function initializePage() {
            loadFromURL();
            changeUnit();
            displayPictures();
            adjustFormPosition();
        }

        function setupEventListeners() {
            setupFormKeypressEvents();
            setupDocumentMouseEvents();
            setupSettingsButtonEvent();
            setupUnitChangeEvent();
            setupGlobalSettingsUpdateEvent();
            setupFormVisibilityCheck();
        }

        function setupFormKeypressEvents() {
            $('#pictureHeight, #pictureWidth, #hangingNailHeight').keypress(function(event) {
                if (event.which == 13) { // Check if the pressed key is 'Enter'
                    event.preventDefault(); // Prevent the default action (form submission)
                    $('#addPictureBtn').click(); // Trigger the add/edit action
                }
            });

            $('#wallWidth, #distanceBetween').keypress(function(event) {
                if (event.which == 13) { // Check if the pressed key is 'Enter'
                    event.preventDefault(); // Prevent the default action (form submission)
                    updateGlobalSettings();
                }
            });
        }

        function setupDocumentMouseEvents() {
            $('#inputForm').on('mousedown', function() {
                mouseDownInsidePopover = true;
                // console.log('Mouse down inside popover:', mouseDownInsidePopover);
            });

            $(document).on('mouseup', function(event) {
                // console.log('Mouse up event triggered');
                // console.log('Mouse up inside popover:', $(event.target).closest('#inputForm').length > 0);
                // console.log('mouseDownInsidePopover:', mouseDownInsidePopover);

                if (!$(event.target).closest('#inputForm').length) {
                    // console.log('Mouse up outside popover');
                    if (!mouseDownInsidePopover) {
                        // console.log('Closing popover');
                        $("#inputForm").addClass("hidden");
                    } else {
                        // console.log('Mouse down started inside popover, not closing');
                    }
                }

                mouseDownInsidePopover = false; // Reset the flag after mouseup
                // console.log('mouseDownInsidePopover reset to:', mouseDownInsidePopover);
            });

            $(document).on('mousedown', function(event) {
                if (!$(event.target).closest('#inputForm, .js-edit-btn, #addNewPictureBtn').length) {
                    mouseDownInsidePopover = false;
                    // console.log('Mouse down outside popover set mouseDownInsidePopover to:', mouseDownInsidePopover);
                }
            });
        }

        function setupSettingsButtonEvent() {
            $(".js-settings-btn").on('click', function() {
                $('#globalSettings').toggleClass('hidden');
            });
        }

        function setupUnitChangeEvent() {
            $('#unit').change(function(){
                changeUnit();
                displayPictures();
                // console.log('Unit changed to:', $('#unit').val());
            });
        }

        function setupGlobalSettingsUpdateEvent() {
            $('#updateGlobalSettingsBtn').click(function() {
                updateGlobalSettings();
                // console.log('Global settings updated.');
            });
        }

        function changeUnit() {
            unit = $('#unit').find(":selected").val();
            if (!unit) {
                unit = "inches";
                $("#unit").val('inches');
            }

            if (unit === "inches") {
                multiplier = 6;
                museumHeight = 57; // Museum height in inches
                unitAbbreviated = "in";
            } else {
                multiplier = 2.25;
                museumHeight = 144; // Museum height in centimeters
                unitAbbreviated = "cm";
            }
            $('#pictureDisplay').addClass(`h-[${museumHeight * 2 * multiplier}px]`);
            updateURL();
        }

        function setFormMode(isEditMode) {
            if (isEditMode) {
                $("#addPictureBtn").text("Edit");
            } else {
                $("#addPictureBtn").text("Add");
                clearForm();
            }
        }

        function editPicture(index) {
            const picture = pictures[index];
            $("#pictureHeight").val(picture.height);
            $("#pictureWidth").val(picture.width);
            $("#hangingNailHeight").val(picture.hangingNailHeight);
            editingIndex = index;
            setFormMode(true);
        }

        $('#unit').change(function(){
            changeUnit();
            displayPictures();
        });

        function loadFromURL() {
            const params = new URLSearchParams(window.location.search);
            const numPictures = Math.max(...Array.from(params.keys()).map(key => rounded(parseFloat(key.replace(/\D/g, ''))) || 0));

            for (let i = 0; i < numPictures; i++) {
                const height = params.get(`picture${i + 1}Height`);
                const width = params.get(`picture${i + 1}Width`);
                const hangingNailHeight = params.get(`picture${i + 1}HangingNailHeight`);

                if (height && width && hangingNailHeight) {
                    pictures.push({
                        height: rounded(parseFloat(height)),
                        width: rounded(parseFloat(width)),
                        hangingNailHeight: rounded(parseFloat(hangingNailHeight))
                    });
                }
            }

            $("#wallWidth").val(params.get('wallWidth') || '');
            $("#distanceBetween").val(params.get('distanceBetween') || '4');
            $("#unit").val(params.get('unit') || '');
        }

        function adjustFormPosition() {
            if (pictures.length === 0) {
                $('#emptyState').show();
            } else {
                $('#emptyState').hide();
            }
        }

        function calculateNailHeight(pictures, index) {
            const distanceBetween = rounded(parseFloat($("#distanceBetween").val())) || 0;

            let totalHeight = pictures.reduce((acc, pic) => acc + pic.height, 0) + (pictures.length - 1) * distanceBetween;
            let floorToBottom = museumHeight - (totalHeight / 2);

            if (index === pictures.length - 1) {
                return floorToBottom + (pictures[index].height - pictures[index].hangingNailHeight);
            }

            let heightFromFloor = floorToBottom;
            for (let i = pictures.length - 1; i > index; i--) {
                heightFromFloor += pictures[i].height + distanceBetween;
            }
            heightFromFloor += pictures[index].height - pictures[index].hangingNailHeight;

            return heightFromFloor;
        }

        function rounded(number) {
            return Math.round(number * 100) / 100;
        }

        function displayPictures() {
            $('#pictureDisplay').empty();
            let totalHeight = 0;

            pictures.forEach((picture, index) => {
                let nailHeight = rounded(calculateNailHeight(pictures, index));
                const isLastPicture = index === pictures.length - 1;
                const marginBottomClass = isLastPicture ? "" : `mb-[${rounded(parseFloat($("#distanceBetween").val())) * multiplier}px]`;

                const pictureElement = $(`
                    <div class="relative group ${marginBottomClass} fade-in" style="animation-delay: ${index * 0.25}s;">
                        <div class="relative transition ease-in-out duration-150 shadow-lg group-hover:shadow-xl ring-4 ring-black ring-inset bg-slate-200 flex justify-center items-center" style="height: ${picture.height * multiplier}px; width: ${picture.width * multiplier}px;" data-index="${index}">
                            <div class="absolute top-[${(picture.hangingNailHeight * 5) - 4}px] text-slate-800">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-2 h-2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
                                </svg>
                            </div>
                            <div class="absolute bottom-2 text-xs text-slate-400">${picture.width}${unitAbbreviated}</div>
                            <div class="absolute right-2 text-xs text-slate-400">${picture.height}${unitAbbreviated}</div>
                            <div class="absolute transition ease-in-out duration-150 -top-2 -right-2 rounded-full cursor-pointer bg-slate-200 text-red-400 p-1 js-remove-btn opacity-0 group-hover:opacity-100 hover:bg-red-400 hover:text-slate-100" data-index="${index}">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor" class="w-4 h-4">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
                                </svg>
                            </div>
                            <div class="absolute transition ease-in-out duration-150 -top-2 -left-2 rounded-full cursor-pointer bg-slate-200 text-blue-400 p-2 js-edit-btn opacity-0 group-hover:opacity-100 hover:bg-blue-400 hover:text-slate-100" data-index="${index}">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor" class="w-3 h-3">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125" />
                                </svg>
                            </div>
                        </div>
                        <div class="absolute top-[${picture.hangingNailHeight * multiplier}px] left-[${(picture.width * multiplier) + 35}px]">
                            <div class="absolute -right-20 text-xs bg-white p-2 opacity-60 group-hover:opacity-100 text-slate-400">
                                <div>Nail Height</div>
                                <div>${nailHeight}${unitAbbreviated}</div>
                            </div>
                            <div class="absolute right-0 border-r border-slate-300 group-hover:border-slate-900" style="height: ${nailHeight * multiplier}px;"></div>
                        </div>
                    </div>
                `);

                $('#pictureDisplay').append(pictureElement);
                totalHeight += Math.min(picture.height, 200) + (index < pictures.length - 1 ? rounded(parseFloat($("#distanceBetween").val())) : 0);
            });

            const addButton = $(`
                <div id="addNewPictureBtn" class="flex flex-col justify-center items-center absolute top-[${(((museumHeight * 2) * multiplier) / 2) + ((totalHeight * multiplier) / 2) + 12}px]">
                    <button class="h-10 w-10 bg-orange-500 hover:bg-orange-400 text-white transition ease-in-out hover:shadow-xl font-extrabold py-2 px-2 rounded-full">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor" class="w-6 h-6">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                        </svg>
                    </button>
                <div>
            `);

            const emptyState = $(`<div id="emptyState" class="font-light text-slate-400 text-sm mt-2">Add Art</div>`);
            $('#pictureDisplay').append(addButton);

            if (pictures.length === 0) {
                $('#addNewPictureBtn').append(emptyState);
            }

            if (totalHeight > 114) {
                $('#errorMessage').text('Pictures are too high to fit the wall!');
            } else {
                $('#errorMessage').text('');
            }
        }

        $('#addPictureBtn').click(function () {
            let height = rounded(parseFloat($("#pictureHeight").val()));
            let width = rounded(parseFloat($("#pictureWidth").val()));
            let hangingNailHeight = rounded(parseFloat($("#hangingNailHeight").val()));

            if (height && width && hangingNailHeight) {
                const picture = { height, width, hangingNailHeight };

                if (editingIndex !== null) {
                    pictures[editingIndex] = picture;
                } else {
                    pictures.push(picture);
                }
                displayPictures();
                updateURL();
                setFormMode(false);
                hideForm();
            }
        });

        function hideForm() {
            $("#inputForm").removeClass('opacity-100 scale-100 -translate-y-1').addClass('opacity-0 scale-95 translate-y-1');
            setTimeout(() => {
                $("#inputForm").addClass('hidden');
            }, 300);
        }

        function showPopoverForm(isEditMode, position) {
            let editHeight;

            if (isEditMode) {
                const picture = pictures[editingIndex];
                $("#pictureHeight").val(picture.height);
                $("#pictureWidth").val(picture.width);
                $("#hangingNailHeight").val(picture.hangingNailHeight);
            } else {
                clearForm();
                editingIndex = null;
            }
            setFormMode(isEditMode);

            const containerWidth = $('#pictureDisplay').width();
            const windowWidth = $(window).width();

            $("#inputForm").removeClass('hidden');
            setTimeout(() => {
                // $("#inputForm").addClass('opacity-0 scale-95');
                $("#inputForm").addClass('opacity-100 scale-100 -translate-y-1');
                $("#inputForm input").first().focus();
            }, 20);
            
            
            if (windowWidth > 768) { // Non-mobile devices
                $("#inputForm").removeClass('hidden').css({
                    left: (containerWidth / 2) - 110,
                    top: position.top + 20
                });
            } else {
                // Mobile devices: No jQuery positioning needed, handled by TailwindCSS
                $("#inputForm").removeClass('hidden').css({
                    left: 0,
                    bottom: 0
                });
            }
            // console.log('Popover form shown. Edit mode:', isEditMode, 'Position:', position);
            
        }

        function setupFormVisibilityCheck() {
            // Check for visibility changes
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.attributeName === 'class') {
                        const isVisible = !$('#inputForm').hasClass('hidden');
                        // console.log('Visibility changed. #inputForm is now', isVisible ? 'visible' : 'hidden');
                    }
                });
            });

            observer.observe(document.getElementById('inputForm'), {
                attributes: true //configure it to listen to attribute changes
            });
        }

        $(".js-remove-btn").click(function(event) {
            const index = $(this).data('index');
            removePicture(index);
        });

        $(document).on('click', '.js-remove-btn', function() {
            const index = $(this).data('index');
            removePicture(index);
        });

        $(document).on('click', '.js-edit-btn', function() {
            const index = $(this).data('index');
            const buttonOffset = $(this).offset();
            editingIndex = index;
            showPopoverForm(true, buttonOffset);
        });

        $(document).on('click', '#addNewPictureBtn', function() {
            const buttonOffset = $(this).offset();
            const containerWidth = $('#pictureDisplay').width();
            showPopoverForm(false, { top: buttonOffset.top - 300, left: (containerWidth / 2) - 165 });
        });

        $("#cancelFormBtn").click(hideForm);

        function updateGlobalSettings() {
            let wallWidth = rounded(parseFloat($("#wallWidth").val()));
            let spaceBetween = rounded(parseFloat($("#distanceBetween").val()));
            let unit = $('#unit').val();

            const windowWidth = $(window).width();
            if (windowWidth < 768) {
                $('#globalSettings').toggleClass('hidden');
            }
            displayPictures();
            updateURL();
            // console.log('Global settings updated. Wall width:', wallWidth, 'Space between:', spaceBetween, 'Unit:', unit);
        }

        function removePicture(index) {
            pictures.splice(index, 1);
            displayPictures();
            updateURL();
        }

        function updateURL() {
            let params = new URLSearchParams();
            pictures.forEach((picture, index) => {
                params.append(`picture${index + 1}Height`, picture.height);
                params.append(`picture${index + 1}Width`, picture.width);
                params.append(`picture${index + 1}HangingNailHeight`, picture.hangingNailHeight);
            });
            params.append('distanceBetween', $("#distanceBetween").val());
            params.append('unit', $("#unit").val());
            history.pushState(null, null, "?" + params.toString());
        }

        function clearForm() {
            $("#pictureHeight").val('');
            $("#pictureWidth").val('');
            $("#hangingNailHeight").val('');
        }
    </script>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7B0WGKYT7M"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-7B0WGKYT7M');
    </script>
</body>

</html>
